---
title: "Table shells"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Table shells}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup, warning=FALSE, message=FALSE}
library(gtreg)
```

# Overview

Mock tables are tables with generic `xx` place holders for numeric
values.  Mock tables can be generated by: 

1. Create dummy data or use your own data.

2. Pass the data to your function of choice.

3. Overwrite the statistic(s) shown to a fixed character string by implementing
the `style_xxx()` function in the `digits` argument. 

Be sure to use the `zero_symbol = NULL` option in `tbl_ae*` functions to 
enable printing of `xx`'s rather than dashes for zero cells.

See more details about the `digits` argument in `?tbl_ae`. Note that
`digits = 1` is the same as `digits = function(x) style_number(x, digits = 1)`.

```{r}
df_patient_characteristics %>%
  select(marker) %>%
  tbl_reg_summary(
    # shortcut specification
    digits = everything() ~ 1
    # full specification
    # digits = everything() ~ function(x) style_number(x, digits = 1)
  )
```

# `tbl_ae()` uniform `xx`

First, we create some dummy data to fill in our table shell. Note
that not all values of grade need to observed as factor levels 
populate the tables.

```{r}
dat_shell <- tibble::tribble(
  ~ id,   ~ soc,   ~ ae, ~ grade,
     1, "SOC 1",  "ae1",       1,  
     2, "SOC 1",  "ae2",       1, 
     3, "SOC 2",  "ae3",       1, 
     4, "SOC 2",  "ae4",       1
  ) |> 
  dplyr::mutate(
    grade = factor(grade, levels = 1:5)
  )

dat_shell
```


Here, we specify the `digits` argument to uniformly apply to all summary
statistics in the table; in this case this is both `n` and `%`.



```{r}
dat_shell %>% 
  tbl_ae(
    id = id,
    ae = ae,
    soc = soc,
    by = grade,
    zero_symbol = NULL,
    digits = purrr::partial(style_xxx, width = 2)
  ) %>%
  modify_header(all_ae_cols() ~ "**Grade {by}**") %>%
  modify_spanning_header(all_ae_cols() ~ "**N = xx**")
```

# `tbl_ae()` custom `xx`

If you want custom formatting that differ between `n` and `%`, specify
the `digits` argument with a `list`.

```{r}
dat_shell %>% 
  tbl_ae(
    id = id,
    ae = ae,
    soc = soc,
    by = grade,
    zero_symbol = NULL,
    digits = list(
      purrr::partial(style_xxx, width = 2), #  n
      purrr::partial(style_xxx, width = 4, digits = 1) # %
    )) %>%
    modify_header(all_ae_cols() ~ "**Grade {by}**") %>%
    modify_spanning_header(all_ae_cols() ~ "**N = xx**")
```


# `tbl_reg_summary()` uniform `xx`

Here, we specify the `digits` argument to uniformly apply to all summary
statistics in the table. 

```{r}
df_patient_characteristics %>%
  select(marker, trt) %>%
    tbl_reg_summary(
      digits = list(
        everything() ~ purrr::partial(style_xxx, width = 2)
    )) %>%
    modify_header(stat_0 ~ "**N = xx**")
```

# `tbl_reg_summary()` custom `xx`

If you want custom formatting that differs between statistics, specify
the `digits` argument with a `list`. Categorical variables have two statistics 
to specify (`n` and `%`); the multiline continuous variables have nine statistics
to specify.


```{r}
df_patient_characteristics %>%
  select(marker, trt) %>%
    tbl_reg_summary(
      digits = list(
        all_categorical() ~ list(
          purrr::partial(style_xxx, width = 2),             # n 
          purrr::partial(style_xxx, width = 4, digits = 1)  # %
          ),    
        all_continuous() ~ list(
          purrr::partial(style_xxx, width = 2),             # N
          purrr::partial(style_xxx, width = 4, digits = 1), # Mean
          purrr::partial(style_xxx, width = 4, digits = 1), # SD
          purrr::partial(style_xxx, width = 2),             # Median
          purrr::partial(style_xxx, width = 2),             # IQR lower
          purrr::partial(style_xxx, width = 2),             # IQR upper
          purrr::partial(style_xxx, width = 2),             # Range lower
          purrr::partial(style_xxx, width = 2),             # Range upper
          purrr::partial(style_xxx, width = 2)              # N missing
    ))) %>%
    modify_header(stat_0 ~ "**N = xx**")
```

